      - name: Criar EXE SFX (autoextrai e executa)
        id: sfx
        shell: pwsh
        run: |
          $outDir   = "${{ steps.find_outdir.outputs.outdir_win }}"
          $exePath  = "${{ steps.exe.outputs.exe_win }}"
          $parent   = Split-Path -Path $outDir -Parent

          # 1) 7-Zip (verifica instalação padrão do runner)
          $sevenZip = "${env:ProgramFiles}\7-Zip\7z.exe"
          if (-not (Test-Path $sevenZip)) { throw "7-Zip não encontrado em $sevenZip" }

          # 2) Compactar toda a pasta em .7z (máxima compressão)
          $archive7z = Join-Path $parent ("SimulIDE-" + $env:VERSION + "-portable.7z")
          if (Test-Path $archive7z) { Remove-Item $archive7z -Force }
          & "$sevenZip" a -t7z -mx=9 $archive7z "$outDir\*"

          # 3) Módulo SFX
          $sfxMod = Join-Path ${env:ProgramFiles} "7-Zip\7z.sfx"
          if (-not (Test-Path $sfxMod)) { throw "Módulo SFX não encontrado em $sfxMod" }

          # 4) Gerar config.txt sem here-string (evita erro de YAML)
          $configPath = Join-Path $parent "config.txt"
          $exeLeaf = Split-Path -Path $exePath -Leaf
          $cfg  = ";!@Install@!UTF-8!`n"
          $cfg += "Title=""SimulIDE Portable""`n"
          $cfg += "RunProgram=""$exeLeaf""`n"
          $cfg += ";!@InstallEnd@!"
          $cfg | Out-File -FilePath $configPath -Encoding UTF8 -Force

          # 5) Concatenar: SFX + config + 7z => EXE final
          $sfxExe = Join-Path $parent ("SimulIDE-" + $env:VERSION + "-windows-mingw64-portable.exe")
          if (Test-Path $sfxExe) { Remove-Item $sfxExe -Force }

          $bytesSfx = [System.IO.File]::ReadAllBytes($sfxMod)
          $bytesCfg = [System.IO.File]::ReadAllBytes($configPath)
          $bytes7z  = [System.IO.File]::ReadAllBytes($archive7z)
          $outBytes = New-Object byte[] ($bytesSfx.Length + $bytesCfg.Length + $bytes7z.Length)
          [Array]::Copy($bytesSfx, 0, $outBytes, 0, $bytesSfx.Length)
          [Array]::Copy($bytesCfg, 0, $outBytes, $bytesSfx.Length, $bytesCfg.Length)
          [Array]::Copy($bytes7z, 0, $outBytes, $bytesSfx.Length + $bytesCfg.Length, $bytes7z.Length)
          [System.IO.File]::WriteAllBytes($sfxExe, $outBytes)

          Write-Host "SFX EXE: $sfxExe"
          echo "sfx=$sfxExe" >> $env:GITHUB_OUTPUT
